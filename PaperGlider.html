<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Éù„ÉÉ„Éó„Éª„Ç∞„É©„Ç§„ÉÄ„ÉºÔºÅ 16:9 ÂÆåÁµêÁâà</title>
    <style>
        :root {
            --pop-yellow: #ffeb3b; --pop-blue: #03a9f4; --pop-red: #ff5252;
        }
        body { margin: 0; overflow: hidden; background: #222; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Arial Rounded MT Bold', sans-serif; }
        #game-container { position: relative; width: 100vw; height: 56.25vw; max-width: 177.78vh; max-height: 100vh; background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%); overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #ui-top { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; }
        .stat-card { background: rgba(255,255,255,0.25); backdrop-filter: blur(5px); padding: 5px 15px; border-radius: 20px; border: 2px solid white; color: white; font-weight: bold; font-size: 1.5vw; }
        .gauge-container { position: absolute; bottom: 20px; color: #fff; background: rgba(0, 0, 0, 0.6); padding: 10px 20px; border-radius: 50px; font-size: 1.8vw; border: 3px solid white; }
        #speed-display { left: 20px; border-color: var(--pop-yellow); }
        #alt-display { left: 220px; border-color: var(--pop-blue); }
        #controls { position: absolute; right: 20px; bottom: 30px; display: flex; flex-direction: column; gap: 15px; pointer-events: auto; }
        .ctrl-btn { width: 7vw; height: 7vw; background: rgba(255, 255, 255, 0.4); border: 4px solid white; border-radius: 50%; color: white; font-size: 3.5vw; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        #skip-btn { position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: var(--pop-yellow); border: 3px solid white; border-radius: 10px; font-weight: bold; cursor: pointer; display: none; pointer-events: auto; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.6; } }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); color: white; text-align: center; pointer-events: auto; }
        button.main-btn { padding: 15px 40px; font-size: 2vw; background: var(--pop-red); color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #c62828; }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div class="ui-layer">
            <div id="ui-top">
                <div class="stat-card" id="distance">Ë∑ùÈõ¢: 0m</div>
                <div class="stat-card" id="hp">HP: 100</div>
                <div class="stat-card" id="time">ÊÆã„ÇäÊôÇÈñì: 30s</div>
            </div>
            <div id="speed-display" class="gauge-container">SPD: <span id="v-val">0</span> kn</div>
            <div id="alt-display" class="gauge-container">ALT: <span id="a-val">0</span> ft</div>
        </div>
        <div id="controls"><div class="ctrl-btn" id="btn-up">‚Üë</div><div class="ctrl-btn" id="btn-down">‚Üì</div></div>
        <div id="skip-btn" onclick="skipToFinish()">ÁùÄÂú∞„Åæ„Åß„Çπ„Ç≠„ÉÉ„Éó ‚è©</div>
        <div id="start-screen" class="overlay"><h1 style="font-size: 4vw;">POP GLIDER</h1><button class="main-btn" onclick="startGame()">START</button></div>
        <div id="msg" class="overlay" style="display: none;"><h1 id="res-title">FINISH!</h1><p id="msg-stats" style="font-size: 2vw;"></p><button class="main-btn" onclick="location.reload()">RETRY</button></div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
const V_WIDTH = 1920, V_HEIGHT = 1080;
canvas.width = V_WIDTH; canvas.height = V_HEIGHT;

let gameState = 'WAITING', clouds = [], buildings = [], items = [], timeOverTick = 0;
const plane = { x: 250, y: 300, vx: 12, vy: 0, angle: 0, hp: 100, time: 30, distance: 0 };
const GRAVITY = 0.15, AIR_RES = 0.0025, FRICTION = 0.97;

function spawnItem() {
    const types = ['HP', 'TIME', 'SPEED', 'UP', 'SPIKE'];
    items.push({ x: V_WIDTH + 200, y: 150 + Math.random() * (V_HEIGHT - 400), type: types[Math.floor(Math.random()*types.length)], active: true });
}

function startGame() { document.getElementById('start-screen').style.display = 'none'; gameState = 'PLAYING'; requestAnimationFrame(update); }

let isUp = false, isDown = false;
document.getElementById('btn-up').onmousedown = document.getElementById('btn-up').ontouchstart = (e) => { e.preventDefault(); isUp = true; };
document.getElementById('btn-up').onmouseup = document.getElementById('btn-up').ontouchend = () => isUp = false;
document.getElementById('btn-down').onmousedown = document.getElementById('btn-down').ontouchstart = (e) => { e.preventDefault(); isDown = true; };
document.getElementById('btn-down').onmouseup = document.getElementById('btn-down').ontouchend = () => isDown = false;

function update() {
    ctx.clearRect(0, 0, V_WIDTH, V_HEIGHT);
    drawWorld();
    
    if (gameState === 'PLAYING') {
        plane.time -= 1/60;
        if (plane.time <= 0) { plane.time = 0; gameState = 'TIMEUP'; }
        if (isUp) { plane.angle -= 0.04; plane.vx -= 0.04; }
        else if (isDown) { plane.angle += 0.04; plane.vx += 0.05; }
        else { plane.angle *= 0.96; }
        plane.vx = Math.max(0, plane.vx - AIR_RES);
        plane.angle = Math.max(-0.7, Math.min(0.7, plane.angle));
        plane.vy = Math.sin(plane.angle) * plane.vx + GRAVITY;
        plane.y += plane.vy;
        plane.distance += plane.vx / 10;
        if (plane.y >= V_HEIGHT - 100) { plane.y = V_HEIGHT - 100; gameState = 'FINISHED'; }
        if (plane.y < 0) plane.y = 0;
        
        // „Ç¢„Ç§„ÉÜ„É†ÁîüÊàêÁÆ°ÁêÜÔºöÂ∏∏„Å´ÁîªÈù¢ÂÜÖ„Å´‰∏ÄÂÆöÊï∞„ÅÇ„Çã„Çà„ÅÜ„Å´
        if (items.length < 10) spawnItem();
        handleItems();
    } else if (gameState === 'TIMEUP') {
        timeOverTick++;
        if (timeOverTick > 300) document.getElementById('skip-btn').style.display = 'block';
        plane.angle *= 0.95;
        plane.vx = Math.max(0, plane.vx - AIR_RES);
        plane.vy = Math.sin(plane.angle) * plane.vx + GRAVITY;
        plane.y += plane.vy;
        plane.distance += plane.vx / 10;
        if (plane.y >= V_HEIGHT - 100) { plane.y = V_HEIGHT - 100; gameState = 'FINISHED'; }
    } else if (gameState === 'FINISHED') {
        plane.vx *= FRICTION;
        plane.distance += plane.vx / 10;
        if (plane.vx < 0.1) { plane.vx = 0; showResult(); }
    }

    drawPlane();
    updateUI();
    if (plane.vx > 0 || plane.y < V_HEIGHT - 100) requestAnimationFrame(update);
}

function handleItems() {
    for (let i = items.length - 1; i >= 0; i--) {
        let it = items[i];
        it.x -= plane.vx;
        if (it.active && Math.hypot(it.x - plane.x, it.y - plane.y) < 40) {
            it.active = false;
            const t = it.type;
            if (t==='HP') plane.hp = Math.min(100, plane.hp+20);
            if (t==='TIME') plane.time += 7;
            if (t==='SPEED') plane.vx += 6;
            if (t==='UP') plane.y -= 200;
            if (t==='SPIKE') { plane.hp -= 30; plane.vx *= 0.5; if(plane.hp<=0) gameState='FINISHED'; }
        }
        if (it.x < -100) items.splice(i, 1);
        else if (it.active) drawItem(it);
    }
}

function drawItem(it) {
    const color = {HP:'#4caf50', TIME:'#2196f3', SPEED:'#ffeb3b', UP:'#e91e63', SPIKE:'#f44336'}[it.type];
    const icon = {HP:'ü©π', TIME:'‚è≥', SPEED:'‚ö°', UP:'üéà', SPIKE:'üåµ'}[it.type];
    ctx.save();
    ctx.beginPath(); ctx.arc(it.x, it.y, 25, 0, 7); ctx.fillStyle = "white"; ctx.fill();
    ctx.strokeStyle = color; ctx.lineWidth = 4; ctx.stroke();
    ctx.font = "28px Arial"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
    ctx.fillText(icon, it.x, it.y + 2); ctx.restore();
}

function skipToFinish() {
    // Áâ©ÁêÜ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂõû„Åó„Å¶ÊúÄÁµÇÂú∞ÁÇπ„ÇíË®àÁÆó
    let s_y = plane.y, s_vx = plane.vx, s_vy = plane.vy, s_dist = plane.distance, s_ang = plane.angle;
    while (s_y < V_HEIGHT - 100 && s_vx > 0) {
        s_ang *= 0.95; s_vx = Math.max(0, s_vx - AIR_RES);
        s_vy = Math.sin(s_ang) * s_vx + GRAVITY;
        s_y += s_vy; s_dist += s_vx / 10;
    }
    s_y = V_HEIGHT - 100;
    while (s_vx > 0.1) { s_vx *= FRICTION; s_dist += s_vx / 10; }
    
    // Âæ©Ê¥ªÊºîÂá∫ÔºàÈ´òÂ∫¶10ftÁõ∏ÂΩì„ÅÆ‰ΩçÁΩÆ„Å∏„ÉØ„Éº„ÉóÔºâ
    plane.y = V_HEIGHT - 120; plane.vx = 0; plane.distance = s_dist;
    gameState = 'FINISHED';
    document.getElementById('skip-btn').style.display = 'none';
}

function drawWorld() {
    ctx.fillStyle = "#388E3C"; ctx.fillRect(0, V_HEIGHT - 80, V_WIDTH, 80);
    if (clouds.length < 8) clouds.push({x: V_WIDTH+100, y: Math.random()*400, s: 0.5+Math.random()});
    clouds.forEach((c, i) => {
        c.x -= plane.vx * 0.3; ctx.fillStyle = "rgba(255,255,255,0.6)";
        ctx.beginPath(); ctx.ellipse(c.x, c.y, 60*c.s, 30*c.s, 0, 0, 7); ctx.fill();
        if (c.x < -200) clouds.splice(i, 1);
    });
}

function drawPlane() {
    ctx.save(); ctx.translate(plane.x, plane.y); ctx.rotate(plane.angle);
    ctx.beginPath(); ctx.moveTo(40, 0); ctx.lineTo(-30, -20); ctx.lineTo(-15, 0); ctx.lineTo(-30, 20); ctx.closePath();
    ctx.fillStyle = "white"; ctx.fill(); ctx.strokeStyle = "#333"; ctx.lineWidth = 3; ctx.stroke();
    ctx.restore();
}

function updateUI() {
    document.getElementById('distance').innerText = `Ë∑ùÈõ¢: ${Math.floor(plane.distance)}m`;
    document.getElementById('hp').innerText = `HP: ${Math.max(0, Math.round(plane.hp))}`;
    document.getElementById('time').innerText = `ÊÆã„ÇäÊôÇÈñì: ${plane.time.toFixed(1)}s`;
    document.getElementById('v-val').innerText = (plane.vx * 1.94).toFixed(1);
    document.getElementById('a-val').innerText = Math.max(0, (V_HEIGHT - 100 - plane.y) * 0.328).toFixed(0);
}

function showResult() {
    document.getElementById('msg').style.display = 'flex';
    document.getElementById('msg-stats').innerHTML = `È£õË°åË∑ùÈõ¢: <strong>${Math.floor(plane.distance)} m</strong>`;
    document.getElementById('skip-btn').style.display = 'none';
}
</script>
</body>
</html>
