<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒãƒƒãƒ—ãƒ»ã‚°ãƒ©ã‚¤ãƒ€ãƒ¼ï¼</title>
    <style>
        :root {
            --pop-yellow: #ffeb3b;
            --pop-blue: #03a9f4;
            --pop-red: #ff5252;
            --ui-bg: rgba(255, 255, 255, 0.2);
        }
        body {
            margin: 0; overflow: hidden;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            font-family: 'Arial Rounded MT Bold', 'Helvetica', sans-serif;
            user-select: none; touch-action: none;
        }
        canvas { display: block; }

        /* UI ä¸Šéƒ¨ */
        #ui-top {
            position: absolute; top: 20px; width: 100%;
            display: flex; justify-content: space-around;
            pointer-events: none;
        }
        .stat-card {
            background: var(--ui-bg); backdrop-filter: blur(5px);
            padding: 8px 15px; border-radius: 20px; border: 2px solid white;
            color: white; font-weight: bold; font-size: 18px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* é€Ÿåº¦ãƒ»é«˜åº¦è¨ˆï¼ˆä¸‹éƒ¨ï¼‰ */
        .gauge-container {
            position: absolute; bottom: 30px;
            color: #fff; background: rgba(0, 0, 0, 0.6);
            padding: 15px 25px; border-radius: 50px;
            font-size: 22px; pointer-events: none;
            border: 3px solid white;
        }
        #speed-display { left: 30px; border-color: var(--pop-yellow); }
        #alt-display { left: 240px; border-color: var(--pop-blue); }

        /* æ“ä½œãƒœã‚¿ãƒ³ï¼ˆå³å´ï¼‰ */
        #controls {
            position: absolute; right: 30px; bottom: 50px;
            display: flex; flex-direction: column; gap: 20px;
        }
        .ctrl-btn {
            width: 80px; height: 80px;
            background: rgba(255, 255, 255, 0.4);
            border: 4px solid white; border-radius: 50%;
            color: white; font-size: 40px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.1s;
        }
        .ctrl-btn:active { transform: scale(0.9); background: rgba(255, 255, 255, 0.6); }

        /* ãƒªã‚¶ãƒ«ãƒˆ */
        #msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; background: white; padding: 40px;
            border-radius: 30px; border: 8px solid var(--pop-blue); display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #msg h1 { color: var(--pop-blue); margin-top: 0; }
        button {
            margin-top: 20px; padding: 15px 40px; font-size: 22px;
            background: var(--pop-red); color: white; border: none;
            border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #c62828;
        }
        button:active { transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body>

    <div id="ui-top">
        <div class="stat-card" id="distance">è·é›¢: 0m</div>
        <div class="stat-card" id="hp">HP: 100</div>
        <div class="stat-card" id="time">æ®‹ã‚Šæ™‚é–“: 30s</div>
    </div>

    <div id="speed-display" class="gauge-container">SPEED: <span id="v-val">0</span> kn</div>
    <div id="alt-display" class="gauge-container">ALT: <span id="a-val">0</span> ft</div>

    <div id="controls">
        <div class="ctrl-btn" id="btn-up">â†‘</div>
        <div class="ctrl-btn" id="btn-down">â†“</div>
    </div>

    <div id="msg">
        <h1>GOAL!</h1>
        <p id="msg-stats" style="font-size: 20px;"></p>
        <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦éŠã¶</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const msgBox = document.getElementById('msg');

let width, height;
let gameState = 'PLAYING';

// ç´™é£›è¡Œæ©Ÿãƒ‡ãƒ¼ã‚¿
const plane = {
    x: 150, y: 0,
    vx: 10, vy: 0,
    angle: 0, hp: 100,
    time: 30, distance: 0,
    width: 50, height: 25
};

// èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼
let clouds = [];
let buildings = [];
let items = [];

const GRAVITY = 0.12;
const FRICTION_GROUND = 0.97;
const CONV_KN = 1.94;
const CONV_FT = 3.28;

/** åˆæœŸåŒ– **/
function init() {
    resize();
    plane.y = height * 0.4;
    
    // é›²ã®åˆæœŸåŒ–
    for(let i=0; i<8; i++) clouds.push({x: Math.random()*width, y: Math.random()*height*0.5, s: 0.2 + Math.random()*0.5});
    // ãƒ“ãƒ«ã®åˆæœŸåŒ–
    for(let i=0; i<10; i++) spawnBuilding(i * (width/5));
    // ã‚¢ã‚¤ãƒ†ãƒ åˆæœŸåŒ–
    spawnItems();
    
    requestAnimationFrame(update);
}

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);

/** å…¥åŠ›ç®¡ç† **/
let isUp = false;
let isDown = false;

document.getElementById('btn-up').addEventListener('touchstart', (e) => { e.preventDefault(); isUp = true; });
document.getElementById('btn-up').addEventListener('touchend', () => isUp = false);
document.getElementById('btn-up').addEventListener('mousedown', () => isUp = true);
document.getElementById('btn-up').addEventListener('mouseup', () => isUp = false);

document.getElementById('btn-down').addEventListener('touchstart', (e) => { e.preventDefault(); isDown = true; });
document.getElementById('btn-down').addEventListener('touchend', () => isDown = false);
document.getElementById('btn-down').addEventListener('mousedown', () => isDown = true);
document.getElementById('btn-down').addEventListener('mouseup', () => isDown = false);

/** ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ **/
function spawnBuilding(xPos) {
    buildings.push({
        x: xPos,
        w: 60 + Math.random() * 100,
        h: 100 + Math.random() * 300,
        color: `hsl(${200 + Math.random()*20}, 50%, ${40 + Math.random()*20}%)`
    });
}

function spawnItems() {
    const types = ['HP', 'TIME', 'SPEED', 'UP', 'SPIKE'];
    for(let i=0; i<10; i++) {
        items.push({
            x: width + Math.random() * 2000,
            y: 100 + Math.random() * (height - 300),
            type: types[Math.floor(Math.random() * types.length)],
            active: true
        });
    }
}

/** ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— **/
function update() {
    ctx.clearRect(0, 0, width, height);
    
    drawBackground();
    
    if (gameState === 'PLAYING') {
        handlePhysics();
        handleItems();
    } else {
        if (plane.y >= height - 60) {
            plane.vx *= FRICTION_GROUND;
            if (plane.vx < 0.1) plane.vx = 0;
        }
        plane.angle *= 0.9; // ç€åœ°æ™‚ã¯æ°´å¹³ã«
    }

    drawPlane();
    updateUI();

    if (plane.vx > 0 || plane.y < height - 60) {
        requestAnimationFrame(update);
    } else {
        showResult();
    }
}

function handlePhysics() {
    if (plane.time > 0) {
        plane.time -= 1/60;
        if (isUp) { plane.angle -= 0.04; plane.vx -= 0.03; }
        else if (isDown) { plane.angle += 0.04; plane.vx += 0.04; }
        else { plane.angle *= 0.95; }
    } else {
        plane.angle *= 0.9;
        items = [];
    }

    plane.angle = Math.max(-0.7, Math.min(0.7, plane.angle));
    plane.vy = Math.sin(plane.angle) * plane.vx + GRAVITY;
    plane.y += plane.vy;
    plane.distance += plane.vx / 10;

    if (plane.y >= height - 60) {
        plane.y = height - 60;
        gameState = 'FINISHED';
    }
    if (plane.y < 0) { plane.y = 0; plane.vy = 0; }
}

/** æç”»ç³» **/
function drawBackground() {
    // é›²ï¼ˆé æ™¯ï¼‰
    ctx.fillStyle = "rgba(255,255,255,0.7)";
    clouds.forEach(c => {
        c.x -= plane.vx * 0.2;
        if(c.x < -100) c.x = width + 100;
        ctx.beginPath();
        ctx.ellipse(c.x, c.y, 40*c.s, 20*c.s, 0, 0, Math.PI*2);
        ctx.fill();
    });

    // ãƒ“ãƒ«ï¼ˆä¸­æ™¯ï¼‰
    buildings.forEach(b => {
        b.x -= plane.vx;
        if(b.x < -200) { b.x = width + Math.random()*100; b.h = 100 + Math.random()*300; }
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, height - b.h - 40, b.w, b.h);
        // çª“
        ctx.fillStyle = "rgba(255,255,255,0.3)";
        for(let i=1; i<3; i++) for(let j=1; j<5; j++) {
            ctx.fillRect(b.x + i*20, height - b.h + j*40, 10, 10);
        }
    });

    // åœ°é¢
    ctx.fillStyle = "#4CAF50";
    ctx.fillRect(0, height - 40, width, 40);
    ctx.fillStyle = "#388E3C";
    ctx.fillRect(0, height - 10, width, 10);
}

function handleItems() {
    items.forEach(item => {
        if (!item.active) return;
        item.x -= plane.vx;

        // è¡çª
        const dx = item.x - plane.x;
        const dy = item.y - plane.y;
        if (Math.sqrt(dx*dx + dy*dy) < 40) {
            item.active = false;
            applyItem(item.type);
        }

        if (item.x < -100) {
            item.x = width + Math.random() * 1000;
            item.y = 100 + Math.random() * (height - 300);
            item.active = true;
        }
        
        // ã‚¢ã‚¤ãƒ†ãƒ æç”»ï¼ˆãƒãƒƒãƒ—ãªæ ä»˜ãï¼‰
        ctx.save();
        ctx.shadowBlur = 10;
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.beginPath();
        ctx.arc(item.x, item.y, 35, 0, Math.PI*2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.strokeStyle = getIconColor(item.type);
        ctx.lineWidth = 4;
        ctx.stroke();
        
        ctx.font = "30px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.shadowBlur = 0;
        ctx.fillText(getIcon(item.type), item.x, item.y + 2);
        ctx.restore();
    });
}

function getIcon(type) {
    const icons = {HP:'ğŸ©¹', TIME:'â³', SPEED:'âš¡', UP:'ğŸˆ', SPIKE:'ğŸŒµ'};
    return icons[type];
}
function getIconColor(type) {
    const colors = {HP:'#4caf50', TIME:'#2196f3', SPEED:'#ffeb3b', UP:'#e91e63', SPIKE:'#f44336'};
    return colors[type];
}

function applyItem(type) {
    switch(type) {
        case 'HP': plane.hp = Math.min(100, plane.hp + 20); break;
        case 'TIME': plane.time += 8; break;
        case 'SPEED': plane.vx += 6; break;
        case 'UP': plane.y -= 150; break;
        case 'SPIKE': plane.hp -= 25; plane.vx *= 0.6; if(plane.hp <= 0) gameState = 'FINISHED'; break;
    }
}

function drawPlane() {
    ctx.save();
    ctx.translate(plane.x, plane.y);
    ctx.rotate(plane.angle);
    
    // ç´™é£›è¡Œæ©Ÿå½±
    ctx.fillStyle = "rgba(0,0,0,0.1)";
    ctx.beginPath();
    ctx.moveTo(30, 5); ctx.lineTo(-25, -5); ctx.lineTo(-10, 5); ctx.lineTo(-25, 15);
    ctx.fill();

    // æœ¬ä½“
    ctx.beginPath();
    ctx.moveTo(30, 0);
    ctx.lineTo(-25, -15);
    ctx.lineTo(-10, 0);
    ctx.lineTo(-25, 15);
    ctx.closePath();
    ctx.fillStyle = (plane.hp > 30) ? "white" : "#ffcdd2";
    ctx.fill();
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // ç¿¼ã®ãƒ©ã‚¤ãƒ³
    ctx.beginPath();
    ctx.moveTo(-10, 0); ctx.lineTo(30, 0);
    ctx.stroke();
    
    ctx.restore();
}

function updateUI() {
    document.getElementById('distance').innerText = `è·é›¢: ${Math.floor(plane.distance)}m`;
    document.getElementById('hp').innerText = `HP: ${Math.max(0, Math.round(plane.hp))}`;
    document.getElementById('time').innerText = `æ®‹ã‚Šæ™‚é–“: ${Math.max(0, plane.time).toFixed(0)}s`;
    
    document.getElementById('v-val').innerText = (plane.vx * CONV_KN).toFixed(1);
    const alt = Math.max(0, (height - 60 - plane.y) * CONV_FT / 10).toFixed(0);
    document.getElementById('a-val').innerText = alt;
}

function showResult() {
    msgBox.style.display = 'block';
    document.getElementById('msg-stats').innerHTML = `
        ç·é£›è¡Œè·é›¢: <strong>${Math.floor(plane.distance)} m</strong><br>
        æœ€çµ‚é«˜åº¦: ${Math.floor((height - 60 - plane.y) * CONV_FT / 10)} ft
    `;
}

init();
</script>
</body>
</html>
