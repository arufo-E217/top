<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Å∂„Å£È£õ„Å≥Á¥ôÈ£õË°åÊ©üDX</title>
    <style>
        :root {
            --pop-yellow: #ffeb3b;
            --pop-blue: #03a9f4;
            --pop-red: #ff5252;
            --pop-green: #4caf50;
            --pop-purple: #9c27b0;
        }
        body {
            margin: 0; overflow: hidden; background: #222;
            display: flex; align-items: center; justify-content: center;
            height: 100vh; font-family: 'Arial Rounded MT Bold', sans-serif;
        }
        #game-container {
            position: relative; width: 100vw; height: 56.25vw; /* 16:9 */
            max-width: 177.78vh; max-height: 100vh;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        canvas { width: 100%; height: 100%; display: block; }

        /* UI */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #ui-top { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; }
        .stat-card {
            background: rgba(255,255,255,0.25); backdrop-filter: blur(5px);
            padding: 5px 15px; border-radius: 20px; border: 2px solid white;
            color: white; font-weight: bold; font-size: 1.5vw;
        }
        .gauge-container {
            position: absolute; bottom: 20px; color: #fff; background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px; border-radius: 50px; font-size: 1.8vw; border: 3px solid white;
        }
        #speed-display { left: 20px; border-color: var(--pop-yellow); }
        #alt-display { left: 220px; border-color: var(--pop-blue); }

        /* Êìç‰Ωú */
        #controls { position: absolute; right: 20px; bottom: 30px; display: flex; flex-direction: column; gap: 15px; pointer-events: auto; }
        .ctrl-btn {
            width: 7vw; height: 7vw; background: rgba(255, 255, 255, 0.4);
            border: 4px solid white; border-radius: 50%; color: white;
            font-size: 3.5vw; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.1s;
        }
        .ctrl-btn:active { transform: scale(0.9); background: rgba(255, 255, 255, 0.6); }

        /* „Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.5); color: white; text-align: center; pointer-events: auto;
        }
        #start-screen { background: rgba(0,0,0,0.3); backdrop-filter: blur(8px); }
        button {
            padding: 15px 40px; font-size: 2vw; background: var(--pop-red);
            color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #c62828;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="ui-layer">
            <div id="ui-top">
                <div class="stat-card" id="distance">Ë∑ùÈõ¢: 0m</div>
                <div class="stat-card" id="hp">HP: 100</div>
                <div class="stat-card" id="time">ÊÆã„ÇäÊôÇÈñì: 30s</div>
            </div>
            <div id="speed-display" class="gauge-container">SPD: <span id="v-val">0</span> kn</div>
            <div id="alt-display" class="gauge-container">ALT: <span id="a-val">0</span> ft</div>
        </div>

        <div id="controls">
            <div class="ctrl-btn" id="btn-up">‚Üë</div>
            <div class="ctrl-btn" id="btn-down">‚Üì</div>
        </div>

        <div id="start-screen" class="overlay">
            <h1 style="font-size: 4vw;">POP GLIDER</h1>
            <p style="font-size: 1.5vw;">Âè≥ÂÅ¥„ÅÆ„Éú„Çø„É≥„ÅßÊ©üÈ¶ñ„ÇíÊìç‰ΩúÔºÅ<br>„Ç¢„Ç§„ÉÜ„É†„ÇíÈõÜ„ÇÅ„Å¶ÈÅ†„Åè„Åæ„ÅßÈ£õ„Å∞„Åù„ÅÜ</p>
            <button onclick="startGame()">START FLIGHT</button>
        </div>

        <div id="msg" class="overlay" style="display: none;">
            <h1 style="color:var(--pop-yellow); font-size: 4vw;">FINISH!</h1>
            <p id="msg-stats" style="font-size: 2vw;"></p>
            <button onclick="location.reload()">TRY AGAIN</button>
        </div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startScreen = document.getElementById('start-screen');
const msgBox = document.getElementById('msg');

// ‰ªÆÊÉ≥Ëß£ÂÉèÂ∫¶Ôºà16:9Ôºâ
const V_WIDTH = 1920;
const V_HEIGHT = 1080;
canvas.width = V_WIDTH;
canvas.height = V_HEIGHT;

let gameState = 'WAITING';
const plane = {
    x: 250, y: 300, vx: 12, vy: 0, angle: 0, 
    hp: 100, time: 30, distance: 0
};

let clouds = [], buildings = [], items = [];
const GRAVITY = 0.15;
const AIR_RESISTANCE = 0.0025; // ÊØé„Éï„É¨„Éº„É†„ÅÆÊ∏õË°∞ÔºàÁ¥Ñ -0.3kt/s Áõ∏ÂΩìÔºâ
const CONV_KN = 1.94;
const CONV_FT = 3.28;

// ÂàùÊúüËÉåÊôØÁîüÊàê
for(let i=0; i<10; i++) clouds.push({x: Math.random()*V_WIDTH, y: Math.random()*V_HEIGHT*0.5, s: 0.3+Math.random()});
for(let i=0; i<8; i++) spawnBuilding(i * (V_WIDTH/6));

function spawnBuilding(x) {
    buildings.push({
        x: x, w: 100+Math.random()*150, h: 200+Math.random()*400,
        color: `hsl(${200+Math.random()*20}, 40%, ${30+Math.random()*20}%)`
    });
}

function startGame() {
    startScreen.style.display = 'none';
    gameState = 'PLAYING';
    requestAnimationFrame(update);
}

// ÂÖ•Âäõ
let isUp = false, isDown = false;
const setupBtn = (id, set) => {
    const el = document.getElementById(id);
    el.onmousedown = el.ontouchstart = (e) => { e.preventDefault(); set(true); };
    el.onmouseup = el.ontouchend = () => set(false);
};
setupBtn('btn-up', v => isUp = v);
setupBtn('btn-down', v => isDown = v);

function update() {
    if (gameState === 'WAITING') return;

    ctx.clearRect(0, 0, V_WIDTH, V_HEIGHT);
    drawWorld();
    
    if (gameState === 'PLAYING') {
        handlePhysics();
        handleItems();
    } else {
        // Âú∞Èù¢Êë©Êì¶
        if (plane.y >= V_HEIGHT - 100) {
            plane.vx *= 0.97;
            if (plane.vx < 0.1) plane.vx = 0;
        }
    }

    drawPlane();
    updateUI();

    if (plane.vx > 0 || plane.y < V_HEIGHT - 100) {
        requestAnimationFrame(update);
    } else {
        showResult();
    }
}

function handlePhysics() {
    // ÊôÇÈñì„Å®Êìç‰Ωú
    if (plane.time > 0) {
        plane.time -= 1/60;
        if (isUp) { plane.angle -= 0.04; plane.vx -= 0.04; }
        else if (isDown) { plane.angle += 0.04; plane.vx += 0.05; }
        else { plane.angle *= 0.96; }
    } else {
        plane.angle *= 0.9;
    }

    // Á©∫Ê∞óÊäµÊäóÔºàÂ∏∏ÊôÇÊ∏õË°∞Ôºâ
    plane.vx = Math.max(0, plane.vx - AIR_RESISTANCE);

    plane.angle = Math.max(-0.7, Math.min(0.7, plane.angle));
    plane.vy = Math.sin(plane.angle) * plane.vx + GRAVITY;
    plane.y += plane.vy;
    plane.distance += plane.vx / 10;

    // Âú∞Èù¢
    if (plane.y >= V_HEIGHT - 100) {
        plane.y = V_HEIGHT - 100;
        gameState = 'FINISHED';
    }
    if (plane.y < 0) plane.y = 0;
}

function handleItems() {
    // „Ç¢„Ç§„ÉÜ„É†„ÅåÂ∞ë„Å™„ÅÑÂ†¥Âêà„ÄÅÂ∏∏„Å´ÂâçÊñπ„Å´Ë£úÂÖÖÔºàË∑ùÈõ¢„Å´Èñ¢„Çè„Çâ„ÅöÔºâ
    if (items.length < 8) {
        const types = ['HP', 'TIME', 'SPEED', 'UP', 'SPIKE'];
        items.push({
            x: V_WIDTH + 100 + Math.random() * V_WIDTH,
            y: 100 + Math.random() * (V_HEIGHT - 300),
            type: types[Math.floor(Math.random()*types.length)],
            active: true
        });
    }

    items.forEach((item, index) => {
        item.x -= plane.vx;
        if (!item.active) return;

        // ÂΩì„Åü„ÇäÂà§ÂÆö
        const dx = item.x - plane.x, dy = item.y - plane.y;
        if (Math.sqrt(dx*dx + dy*dy) < 45) {
            item.active = false;
            applyItem(item.type);
        }

        // ÊèèÁîª (80%„Çµ„Ç§„Ç∫ = ÂçäÂæÑÁ¥Ñ28)
        ctx.save();
        ctx.beginPath();
        ctx.arc(item.x, item.y, 28, 0, Math.PI*2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.strokeStyle = getIconColor(item.type);
        ctx.lineWidth = 5;
        ctx.stroke();
        ctx.font = "32px Arial";
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText(getIcon(item.type), item.x, item.y + 2);
        ctx.restore();

        // ÁîªÈù¢Â§ñÂâäÈô§
        if (item.x < -100) items.splice(index, 1);
    });
}

function applyItem(type) {
    if (type === 'HP') plane.hp = Math.min(100, plane.hp + 20);
    if (type === 'TIME') plane.time += 7;
    if (type === 'SPEED') plane.vx += 6;
    if (type === 'UP') plane.y -= 200;
    if (type === 'SPIKE') { plane.hp -= 30; plane.vx *= 0.5; if(plane.hp <= 0) gameState = 'FINISHED'; }
}

function getIcon(type) { return {HP:'ü©π', TIME:'‚è≥', SPEED:'‚ö°', UP:'üéà', SPIKE:'üåµ'}[type]; }
function getIconColor(type) { return {HP:'#4caf50', TIME:'#2196f3', SPEED:'#ffeb3b', UP:'#e91e63', SPIKE:'#f44336'}[type]; }

function drawWorld() {
    // Èõ≤
    ctx.fillStyle = "rgba(255,255,255,0.6)";
    clouds.forEach(c => {
        c.x -= plane.vx * 0.3;
        if (c.x < -200) c.x = V_WIDTH + 200;
        ctx.beginPath(); ctx.ellipse(c.x, c.y, 60*c.s, 30*c.s, 0, 0, Math.PI*2); ctx.fill();
    });
    // „Éì„É´
    buildings.forEach(b => {
        b.x -= plane.vx;
        if (b.x < -300) b.x = V_WIDTH + Math.random()*200;
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, V_HEIGHT - b.h - 80, b.w, b.h);
    });
    // Âú∞Èù¢
    ctx.fillStyle = "#388E3C"; ctx.fillRect(0, V_HEIGHT - 80, V_WIDTH, 80);
}

function drawPlane() {
    ctx.save();
    ctx.translate(plane.x, plane.y);
    ctx.rotate(plane.angle);
    ctx.beginPath();
    ctx.moveTo(40, 0); ctx.lineTo(-30, -20); ctx.lineTo(-15, 0); ctx.lineTo(-30, 20); ctx.closePath();
    ctx.fillStyle = "white"; ctx.fill();
    ctx.strokeStyle = "#333"; ctx.lineWidth = 3; ctx.stroke();
    ctx.restore();
}

function updateUI() {
    document.getElementById('distance').innerText = `Ë∑ùÈõ¢: ${Math.floor(plane.distance)}m`;
    document.getElementById('hp').innerText = `HP: ${Math.max(0, Math.round(plane.hp))}`;
    document.getElementById('time').innerText = `ÊÆã„ÇäÊôÇÈñì: ${Math.max(0, plane.time).toFixed(1)}s`;
    document.getElementById('v-val').innerText = (plane.vx * CONV_KN).toFixed(1);
    document.getElementById('a-val').innerText = Math.max(0, (V_HEIGHT - 100 - plane.y) * CONV_FT / 10).toFixed(0);
}

function showResult() {
    msgBox.style.display = 'flex';
    document.getElementById('msg-stats').innerHTML = `È£õË°åË∑ùÈõ¢: <strong>${Math.floor(plane.distance)} m</strong>`;
}
</script>
</body>
</html>
