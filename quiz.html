<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>英単語4択クイズ 完全版</title>
<style>
body{
  font-family:sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
  margin:0;
  padding:20px;
}
#quizBox{
  background:rgba(255,255,255,0.08);
  padding:25px;
  border-radius:15px;
  max-width:800px;
  margin:auto;
}
.word{font-size:32px;margin:20px;}
button{
  padding:10px;
  margin:6px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.choices button{
  display:block;
  width:100%;
  margin:8px 0;
}
.correct{background:#4caf50!important;}
.wrong{background:#e53935!important;}
#stats{margin-top:15px;font-size:15px;}
.comboEffect{
  position:fixed;
  top:40%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:48px;
  font-weight:bold;
  color:#ffd700;
  opacity:0;
}
@keyframes pop{
  0%{opacity:0;transform:translate(-50%,-50%) scale(0.5);}
  50%{opacity:1;transform:translate(-50%,-50%) scale(1.3);}
  100%{opacity:0;}
}
</style>
</head>
<body>

<h2>英単語4択クイズ</h2>
<button id="modeBtn">英→日</button>

<div id="quizBox">
  <div class="word" id="question"></div>
  <div class="choices" id="choices"></div>

  <div id="stats">
    <div>周回: <span id="lap">1</span>周目</div>
    <div>進捗: <span id="progress">0</span>%</div>
    <div>スコア: <span id="score">0</span></div>
    <div>コンボ: <span id="combo">0</span></div>
    <div>正解: <span id="correctCount">0</span> |
         誤答: <span id="wrongCount">0</span> |
         正答率: <span id="accuracy">0</span>%</div>
  </div>
</div>

<div id="comboEffect" class="comboEffect"></div>

<script>
const words=[
// ★ 省略なし（前回と同じ全単語データ）
{word:"infinite",meaning:"無限の；無数の"},
{word:"worthwhile",meaning:"価値がある；立派な"},
{word:"indispensable",meaning:"不可欠な"},
{word:"compulsory",meaning:"義務的な，強制的な"},
{word:"probable",meaning:"十分にありそうな"},
{word:"ambiguous",meaning:"あいまいな；多義的な"},
{word:"obscure",meaning:"（世に）知られていない；不明瞭な"},
{word:"skeptical",meaning:"懐疑的な"},
{word:"fragile",meaning:"壊れやすい；虚弱な"},
{word:"static",meaning:"静的な；動きのない"},
{word:"gradual",meaning:"徐々の，緩やかな"},
{word:"vocal",meaning:"声の；はっきりものを言う"},
{word:"vivid",meaning:"鮮やかな；生き生きとした"},
{word:"imperial",meaning:"帝国の；皇帝の"},
{word:"hostile",meaning:"敵意のある"},
{word:"superficial",meaning:"表面的な"},
{word:"scarce",meaning:"乏しい；珍しい"},
{word:"gross",meaning:"総計の；甚だしい；粗野な"},
{word:"inherent",meaning:"生来の，本来的に備わっている"},
{word:"notable",meaning:"注目に値する；著名な"},
{word:"update",meaning:"を最新のものにする"},
{word:"refresh",meaning:"さわやかにする；新たにする；最新にする"},
{word:"bloom",meaning:"花が咲く；栄える"},
{word:"conquer",meaning:"征服する；克服する"},
{word:"induce",meaning:"引き起こす；説得する"},
{word:"attain",meaning:"獲得する；達する"},
{word:"spray",meaning:"吹きかける"},
{word:"retrieve",meaning:"検索する；取り戻す"},
{word:"portray",meaning:"描く；演じる"},
{word:"scratch",meaning:"引っかく；削除する"},
{word:"designate",meaning:"指定する；任命する"},
{word:"contradict",meaning:"矛盾する；反対意見を言う"},
{word:"sigh",meaning:"ため息をつく"},
{word:"disrupt",meaning:"混乱させる；分裂させる"},
{word:"depart",meaning:"出発する；それる"},
{word:"navigate",meaning:"誘導する；操縦する；航行する"},
{word:"beg",meaning:"切に頼む；懇願する"},
{word:"inhabit",meaning:"住んでいる；宿る"},
{word:"diagnose",meaning:"診断する"},
{word:"comprehend",meaning:"理解する"},
{word:"oblige",meaning:"義務づける；恩恵を施す"},
{word:"cram",meaning:"詰め込む；詰め込み勉強をする"},
{word:"flock",meaning:"群がる，集まる"},
{word:"underestimate",meaning:"過小評価する"},
{word:"clarify",meaning:"明確にする"},
{word:"spark",meaning:"引き起こす；刺激する"},
{word:"seize",meaning:"つかむ；奪う；没収する"},
{word:"soar",meaning:"急上昇する；高く飛ぶ"},
{word:"glow",meaning:"輝く；赤く燃える"},
{word:"disguise",meaning:"変装させる；偽る"},
{word:"distort",meaning:"歪める；歪む"},
{word:"undermine",meaning:"徐々にむしばむ；侵食する"},
{word:"abolish",meaning:"廃止する"},
{word:"strip",meaning:"取り去る；裸にする"},
{word:"dispose",meaning:"処分する；気にさせる；配置する"},
{word:"dump",meaning:"投棄する；どさっと落とす"},
{word:"weave",meaning:"織る；作り上げる"},
{word:"refine",meaning:"洗練する；精製する"},
{word:"enrich",meaning:"豊かにする；濃縮する"},
{word:"coordinate",meaning:"調整する；組織する"}
];

let state=JSON.parse(localStorage.getItem("quizState"))||{
  lap:1,score:0,combo:0,
  correct:0,wrong:0,
  mode:"en"
};

let unseen=[],mistakes=[];
let current=null;
let lastQuestion=null;
let startTime;

function save(){localStorage.setItem("quizState",JSON.stringify(state));}

function initLap(){
  unseen=[...words];
  mistakes=[];
}

if(!localStorage.getItem("quizState")) initLap();
else initLap();

function nextQuestion(){
  if(unseen.length===0){
    state.lap++;
    initLap();
  }

  let pool = mistakes.length>0?mistakes:unseen;
  let candidate;
  do{
    candidate = pool[Math.floor(Math.random()*pool.length)];
  }while(candidate===lastQuestion && pool.length>1);

  current=candidate;
  lastQuestion=current;
  unseen=unseen.filter(w=>w!==current);

  renderQuestion();
  startTime=Date.now();
  updateStats();
  save();
}

function renderQuestion(){
  const q=document.getElementById("question");
  const choices=document.getElementById("choices");
  choices.innerHTML="";

  let correctAnswer = state.mode==="en"?current.meaning:current.word;
  q.textContent = state.mode==="en"?current.word:current.meaning;

  let options=[correctAnswer];
  while(options.length<4){
    let rand=words[Math.floor(Math.random()*words.length)];
    let val = state.mode==="en"?rand.meaning:rand.word;
    if(!options.includes(val)) options.push(val);
  }
  options.sort(()=>Math.random()-0.5);

  options.forEach(opt=>{
    const btn=document.createElement("button");
    btn.textContent=opt;
    btn.onclick=()=>checkAnswer(btn,opt,correctAnswer);
    choices.appendChild(btn);
  });
}

function checkAnswer(btn,selected,correctAnswer){
  const buttons=document.querySelectorAll(".choices button");
  buttons.forEach(b=>b.disabled=true);

  let timeTaken=(Date.now()-startTime)/1000;
  let timeBonus=Math.max(0,500-Math.floor(timeTaken*100));

  if(selected===correctAnswer){
    btn.classList.add("correct");
    state.combo++;
    state.correct++;
    let comboBonus=state.combo*50;
    state.score+=1000+comboBonus+timeBonus;

    mistakes=mistakes.filter(w=>w!==current);
    showCombo();
  }else{
    btn.classList.add("wrong");
    state.combo=0;
    state.wrong++;
    if(!mistakes.includes(current)) mistakes.push(current);

    buttons.forEach(b=>{
      if(b.textContent===correctAnswer) b.classList.add("correct");
    });
  }

  updateStats();
  save();
  setTimeout(nextQuestion,800);
}

function updateStats(){
  document.getElementById("lap").textContent=state.lap;
  document.getElementById("score").textContent=state.score;
  document.getElementById("combo").textContent=state.combo;
  document.getElementById("correctCount").textContent=state.correct;
  document.getElementById("wrongCount").textContent=state.wrong;

  let total=state.correct+state.wrong;
  let acc= total?((state.correct/total)*100).toFixed(1):0;
  document.getElementById("accuracy").textContent=acc;

  let progress = ((words.length-unseen.length)/words.length*100).toFixed(1);
  document.getElementById("progress").textContent=progress;
}

function showCombo(){
  if(state.combo%5===0){
    const e=document.getElementById("comboEffect");
    e.textContent=state.combo+" COMBO!";
    e.style.animation="none";
    void e.offsetWidth;
    e.style.animation="pop 0.8s";
  }
}

document.getElementById("modeBtn").onclick=()=>{
  state.mode = state.mode==="en"?"ja":"en";
  document.getElementById("modeBtn").textContent =
    state.mode==="en"?"英→日":"日→英";
  save();
  nextQuestion();
};

nextQuestion();
</script>

</body>
</html>
