<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>永劫役所：一攫千金シュミレーター</title>
    <style>
        body { background: #1a1a1a; color: #eee; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding-top: 20px; user-select: none; }
        #game-box { width: 450px; background: #222; border: 3px solid #444; padding: 20px; border-radius: 10px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .stat-box { background: #000; color: #0f0; padding: 15px; font-size: 1.5rem; text-align: center; border-radius: 5px; margin-bottom: 15px; border: 1px solid #333; }
        
        /* 宝くじ購入セクション */
        .lottery-section { background: #331111; border: 2px solid #662222; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .btn-buy { background: #e67e22; color: white; border: none; padding: 15px; width: 100%; font-size: 1.2rem; cursor: pointer; border-bottom: 4px solid #d35400; font-weight: bold; }
        .btn-buy:active { transform: translateY(2px); border-bottom: 2px solid #d35400; }
        .btn-buy:disabled { background: #555; border: none; cursor: not-allowed; }

        /* 当選ログ */
        #log { height: 120px; overflow-y: hidden; background: #111; padding: 10px; font-size: 0.85rem; border: 1px solid #333; display: flex; flex-direction: column-reverse; }
        .win { color: #f1c40f; font-weight: bold; animation: flash 0.5s; }
        .lose { color: #666; }
        
        @keyframes flash { 0% { opacity: 0; } 100% { opacity: 1; } }

        .auto-status { font-size: 0.8rem; color: #888; margin-top: 5px; text-align: right; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; background: #2c3e50; padding: 10px; margin-top: 5px; border-radius: 4px; }
        .btn-small { background: #27ae60; border: none; color: white; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-box">
        <h2 style="margin:0 0 10px; text-align:center; color:#e74c3c;">徳の宝くじシュミレーター</h2>
        
        <div class="stat-box">
            所持金: <span id="money">3000</span> 円
        </div>

        <div class="lottery-section">
            <button id="buy-btn" class="btn-buy" onclick="buyTicket()">宝くじを10枚買う (3,000円)</button>
            <div class="auto-status" id="auto-info">自動購入: 未稼働</div>
        </div>

        <div id="log"></div>

        <h3 style="font-size: 0.9rem; border-bottom: 1px solid #444; margin-top: 20px;">闇市（アップグレード）</h3>
        <div class="shop-item">
            <span>自動購入ロボ（1秒/10枚）</span>
            <button id="up1" class="btn-small" onclick="buyAuto(10000)">10,000円</button>
        </div>
        <div class="shop-item">
            <span>当選確率の改ざん（幸運+）</span>
            <button id="up2" class="btn-small" onclick="improveLuck(50000)">50,000円</button>
        </div>
    </div>

<script>
    let money = 3000;
    let autoLevel = 0;
    let luckFactor = 0; // 当選しやすさ

    const logEl = document.getElementById('log');

    function updateUI() {
        document.getElementById('money').innerText = Math.floor(money).toLocaleString();
        document.getElementById('buy-btn').disabled = money < 3000;
        document.getElementById('up1').disabled = money < 10000;
        document.getElementById('up2').disabled = money < 50000;
    }

    function addLog(msg, className) {
        const div = document.createElement('div');
        div.className = className;
        div.innerText = msg;
        logEl.prepend(div);
        if (logEl.childNodes.length > 8) logEl.removeChild(logEl.lastChild);
    }

    function buyTicket() {
        if (money < 3000) return;
        money -= 3000;
        
        let totalWin = 0;
        let results = { "1等": 0, "2等": 0, "3等": 0, "外れ": 0 };

        for (let i = 0; i < 10; i++) {
            let rand = Math.random() * 1000000; // 100万分の1
            
            // 運の要素を加味
            rand -= luckFactor;

            if (rand < 1) { 
                results["1等"]++; totalWin += 100000000; // 1億円
            } else if (rand < 50) { 
                results["2等"]++; totalWin += 1000000; // 100万円
            } else if (rand < 5000) { 
                results["3等"]++; totalWin += 3000; // 3000円
            } else {
                results["外れ"]++;
            }
        }

        money += totalWin;
        
        if (totalWin > 3000) {
            addLog(`【当選！】 ${totalWin.toLocaleString()}円獲得！`, "win");
        } else {
            addLog(`10枚購入... 全滅。`, "lose");
        }
        updateUI();
    }

    function buyAuto(cost) {
        if (money >= cost) {
            money -= cost;
            autoLevel++;
            document.getElementById('auto-info').innerText = `自動購入: 稼働中 (Lv.${autoLevel})`;
            updateUI();
        }
    }

    function improveLuck(cost) {
        if (money >= cost) {
            money -= cost;
            luckFactor += 500; // 確率を底上げ
            addLog("徳を積んで当選確率を上げた...", "win");
            updateUI();
        }
    }

    // 自動購入ループ
    setInterval(() => {
        if (autoLevel > 0) {
            for(let i=0; i<autoLevel; i++) buyTicket();
        }
    }, 1000);

    updateUI();
</script>
</body>
</html>
